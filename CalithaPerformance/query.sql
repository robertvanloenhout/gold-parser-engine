SELECT  DOC_PARAM_EXT.KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_ODSTAPIENIE_OD_UMOWY_KWOTA_LICZBA_3 AS DOC_PARAM_EXT__KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_ODSTAPIENIE_OD_UMOWY_KWOTA_LICZBA_3, DOC_PARAM_EXT.KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_OPOZNIENIE_WYDANIA__ZA_KAZDY_DZIEN_OD_WARTOSCI_PRZEDPLATY_LICZBA_3 AS DOC_PARAM_EXT__KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_OPOZNIENIE_WYDANIA__ZA_KAZDY_DZIEN_OD_WARTOSCI_PRZEDPLATY_LICZBA_3, DOC_PARAM_EXT.KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_OPOZNIENIE_WYDANIA__ZA_KAZDY_DZIEN_OD_WARTOSCI_TOWARU_LICZBA_3 AS DOC_PARAM_EXT__KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_OPOZNIENIE_WYDANIA__ZA_KAZDY_DZIEN_OD_WARTOSCI_TOWARU_LICZBA_3, DOC_PARAM_EXT.KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_OPOZNIENIE_WYDANIA_KWOTA_LICZBA_3 AS DOC_PARAM_EXT__KARY_UMOWNE_Z_WINY_SPRZEDAWCY_ZA_OPOZNIENIE_WYDANIA_KWOTA_LICZBA_3, DOC_PARAM_EXT.ODSTAPIENIE_OD_UMOWY_PRZEZ_SPRZEDAWCE_Z_WINY_KUPUJ_KARA_UMOWNA__WARTOSCI_TOWARU_Z_UMOWY_LICZBA_1 AS DOC_PARAM_EXT__ODSTAPIENIE_OD_UMOWY_PRZEZ_SPRZEDAWCE_Z_WINY_KUPUJ_KARA_UMOWNA__WARTOSCI_TOWARU_Z_UMOWY_LICZBA_1, DOC_PARAM_EXT.ODSTAPIENIE_OD_UMOWY_PRZEZ_SPRZEDAWCE_Z_WINY_KUPUJ_KARA_UMOWNA_KWOTA_LICZBA_1 AS DOC_PARAM_EXT__ODSTAPIENIE_OD_UMOWY_PRZEZ_SPRZEDAWCE_Z_WINY_KUPUJ_KARA_UMOWNA_KWOTA_LICZBA_1, KONTRAHENT.A_GMINA AS KONTRAHENT__A_GMINA, KONTRAHENT.A_KOD AS KONTRAHENT__A_KOD, KONTRAHENT.A_KRAJ AS KONTRAHENT__A_KRAJ, KONTRAHENT.A_MIASTO AS KONTRAHENT__A_MIASTO, KONTRAHENT.A_POCZTA AS KONTRAHENT__A_POCZTA, KONTRAHENT.A_POWIAT AS KONTRAHENT__A_POWIAT, KONTRAHENT.A_ULICA AS KONTRAHENT__A_ULICA, KONTRAHENT.A_WOJEWODZTWO AS KONTRAHENT__A_WOJEWODZTWO, KONTRAHENT.AKTYWNY AS KONTRAHENT__AKTYWNY, KONTRAHENT.IS_DOSTAWCA AS KONTRAHENT__IS_DOSTAWCA, KONTRAHENT.IS_FAKTZBIORCZY AS KONTRAHENT__IS_FAKTZBIORCZY, KONTRAHENT.IS_KOMPENSATA AS KONTRAHENT__IS_KOMPENSATA, KONTRAHENT.IS_PLATNOSCPOTEM AS KONTRAHENT__IS_PLATNOSCPOTEM, KONTRAHENT.KONTR_MYUSER_CON AS KONTRAHENT__KONTR_MYUSER_CON, KONTRAHENT.KONTRAHENT_ID AS KONTRAHENT__KONTRAHENT_ID, KONTRAHENT.NAZWA AS KONTRAHENT__NAZWA, KONTRAHENT.NIP AS KONTRAHENT__NIP, KONTRAHENT.NUMER AS KONTRAHENT__NUMER, KONTRAHENT.PLATNOSCPOTEM_WARTOSC AS KONTRAHENT__PLATNOSCPOTEM_WARTOSC, KONTRAHENT.STATUS_DANE AS KONTRAHENT__STATUS_DANE, KONTRAHENT.UWAGI AS KONTRAHENT__UWAGI, ZAMDOC_KL.DATA AS ZAMDOC_KL__DATA, ZAMDOC_KL.DOC_NUMERACJA_PROFORMA AS ZAMDOC_KL__DOC_NUMERACJA_PROFORMA, ZAMDOC_KL.DOC_NUMERACJA_UMPW AS ZAMDOC_KL__DOC_NUMERACJA_UMPW, ZAMDOC_KL.DOC_NUMERACJA_UMSP AS ZAMDOC_KL__DOC_NUMERACJA_UMSP, ZAMDOC_KL.DOC_NUMERACJA_ZAMIN AS ZAMDOC_KL__DOC_NUMERACJA_ZAMIN, ZAMDOC_KL.DOC_POWIAZANY AS ZAMDOC_KL__DOC_POWIAZANY, ZAMDOC_KL.DOC_PROFORMA_DATA AS ZAMDOC_KL__DOC_PROFORMA_DATA, ZAMDOC_KL.DOC_UMPW_DATA AS ZAMDOC_KL__DOC_UMPW_DATA, ZAMDOC_KL.DOC_UMSP_DATA AS ZAMDOC_KL__DOC_UMSP_DATA, ZAMDOC_KL.DOC_ZAMIN_DATA AS ZAMDOC_KL__DOC_ZAMIN_DATA, ZAMDOC_KL.FINANSOWANIE_RODZAJ AS ZAMDOC_KL__FINANSOWANIE_RODZAJ, ZAMDOC_KL.IS_KSG AS ZAMDOC_KL__IS_KSG, ZAMDOC_KL.KONTR_ADRES AS ZAMDOC_KL__KONTR_ADRES, ZAMDOC_KL.KONTR_NAZWA AS ZAMDOC_KL__KONTR_NAZWA, ZAMDOC_KL.KONTR_NIP AS ZAMDOC_KL__KONTR_NIP, ZAMDOC_KL.KONTR_OSOBA AS ZAMDOC_KL__KONTR_OSOBA, ZAMDOC_KL.KONTRAHENT_ID AS ZAMDOC_KL__KONTRAHENT_ID, ZAMDOC_KL.NUMER AS ZAMDOC_KL__NUMER, ZAMDOC_KL.NUMER_ROK AS ZAMDOC_KL__NUMER_ROK, ZAMDOC_KL.UWAGI AS ZAMDOC_KL__UWAGI, ZAMDOC_DS.DATA AS ZAMDOC_DS__DATA, ZAMDOC_DS.DATA_POTWIERDZENIA AS ZAMDOC_DS__DATA_POTWIERDZENIA, ZAMDOC_DS.DATA_WYSLANIA AS ZAMDOC_DS__DATA_WYSLANIA, ZAMDOC_DS.DOC_POTWIERDZENIA AS ZAMDOC_DS__DOC_POTWIERDZENIA, ZAMDOC_DS.DOC_POWIAZANY AS ZAMDOC_DS__DOC_POWIAZANY, ZAMDOC_DS.KONTR_ADRES AS ZAMDOC_DS__KONTR_ADRES, ZAMDOC_DS.KONTR_NAZWA AS ZAMDOC_DS__KONTR_NAZWA, ZAMDOC_DS.KONTR_NIP AS ZAMDOC_DS__KONTR_NIP, ZAMDOC_DS.KONTR_OSOBA AS ZAMDOC_DS__KONTR_OSOBA, ZAMDOC_DS.NUMER AS ZAMDOC_DS__NUMER, ZAMDOC_DS.TERMIN AS ZAMDOC_DS__TERMIN, ZAMDOC_DS.UWAGI AS ZAMDOC_DS__UWAGI, ZAMDOC_DS.ZAMDOC_ID AS ZAMDOC_DS__ZAMDOC_ID, ZAMDOC_POS_KL.AUTO_POTRZEBA_ID AS ZAMDOC_POS_KL__AUTO_POTRZEBA_ID, ZAMDOC_POS_KL.DATA_SPRZEDAZ AS ZAMDOC_POS_KL__DATA_SPRZEDAZ, ZAMDOC_POS_KL.DATA_TRANS_END AS ZAMDOC_POS_KL__DATA_TRANS_END, ZAMDOC_POS_KL.IS_ANULOWANO AS ZAMDOC_POS_KL__IS_ANULOWANO, ZAMDOC_POS_KL.IS_COMPLETE AS ZAMDOC_POS_KL__IS_COMPLETE, ZAMDOC_POS_KL.IS_POTRZEBA_OK AS ZAMDOC_POS_KL__IS_POTRZEBA_OK, ZAMDOC_POS_KL.IS_REZERWACJA_OK AS ZAMDOC_POS_KL__IS_REZERWACJA_OK, ZAMDOC_POS_KL.IS_UMOWA_OK AS ZAMDOC_POS_KL__IS_UMOWA_OK, ZAMDOC_POS_KL.NAZWA AS ZAMDOC_POS_KL__NAZWA, ZAMDOC_POS_KL.NR_KATALOGOWY AS ZAMDOC_POS_KL__NR_KATALOGOWY, ZAMDOC_POS_KL.TERMIN AS ZAMDOC_POS_KL__TERMIN, ZAMDOC_POS_KL.TERMIN_END AS ZAMDOC_POS_KL__TERMIN_END, ZAMDOC_POS_KL.TERMIN_WYDANIA_WERYF AS ZAMDOC_POS_KL__TERMIN_WYDANIA_WERYF, ZAMDOC_POS_KL.WARUNEK_WYDANIA_TERMIN AS ZAMDOC_POS_KL__WARUNEK_WYDANIA_TERMIN, ZAMDOC_POS_KL.WARUNEK_WYDANIA_WPLATA AS ZAMDOC_POS_KL__WARUNEK_WYDANIA_WPLATA, ZAMDOC_POS_DS.DATA_POTWIERDZENIA AS ZAMDOC_POS_DS__DATA_POTWIERDZENIA, ZAMDOC_POS_DS.DOC_POTWIERDZENIA AS ZAMDOC_POS_DS__DOC_POTWIERDZENIA, ZAMDOC_POS_DS.IS_ANULOWANO AS ZAMDOC_POS_DS__IS_ANULOWANO, ZAMDOC_POS_DS.NAZWA AS ZAMDOC_POS_DS__NAZWA, ZAMDOC_POS_DS.NR_KATALOGOWY AS ZAMDOC_POS_DS__NR_KATALOGOWY, ZAMDOC_POS_DS.OCLENIE_DATA AS ZAMDOC_POS_DS__OCLENIE_DATA, ZAMDOC_POS_DS.RACHUNEK_NUMER AS ZAMDOC_POS_DS__RACHUNEK_NUMER, ZAMDOC_POS_DS.RODZAJ AS ZAMDOC_POS_DS__RODZAJ, ZAMDOC_POS_DS.SPECYFIKACJA AS ZAMDOC_POS_DS__SPECYFIKACJA, ZAMDOC_POS_DS.TERMIN_DOSTAWY AS ZAMDOC_POS_DS__TERMIN_DOSTAWY, ZAMDOC_POS_DS.ZAMDOST_DATA AS ZAMDOC_POS_DS__ZAMDOST_DATA, ZAMDOC_POS_DS.ZAMDOSTPLAN_DATA AS ZAMDOC_POS_DS__ZAMDOSTPLAN_DATA, ZAMDOC_POS_DS.ZAMDOSTPOTW_DATA AS ZAMDOC_POS_DS__ZAMDOSTPOTW_DATA, ZAMDOC_POS_DS.ZAMDOSTREAL_DATA AS ZAMDOC_POS_DS__ZAMDOSTREAL_DATA, ZAMDOC_POS_DS.ZAMDOSTWERYF_DATA AS ZAMDOC_POS_DS__ZAMDOSTWERYF_DATA, AUTO_REZ.AUTO_ID AS AUTO_REZ__AUTO_ID, AUTO_REZ.AUTO_TYP_OPIS AS AUTO_REZ__AUTO_TYP_OPIS, AUTO_REZ.CENA_DOPOSAZENIE AS AUTO_REZ__CENA_DOPOSAZENIE, AUTO_REZ.F_CENA_OSTATECZNA AS AUTO_REZ__F_CENA_OSTATECZNA, AUTO_REZ.F_GOTOWY AS AUTO_REZ__F_GOTOWY, AUTO_REZ.HOMOLOGACJA AS AUTO_REZ__HOMOLOGACJA, AUTO_REZ.IS_OFERTA AS AUTO_REZ__IS_OFERTA, AUTO_REZ.KOD_PRODUCENT AS AUTO_REZ__KOD_PRODUCENT, AUTO_REZ.LICZNIK AS AUTO_REZ__LICZNIK, AUTO_REZ.MARKA_MODEL_TYP AS AUTO_REZ__MARKA_MODEL_TYP, AUTO_REZ.NR_NADWOZIA AS AUTO_REZ__NR_NADWOZIA, AUTO_REZ.NR_SILNIKA AS AUTO_REZ__NR_SILNIKA, AUTO_REZ.REJESTRACJA AS AUTO_REZ__REJESTRACJA, AUTO_REZ.ROK_PRODUKCJI AS AUTO_REZ__ROK_PRODUKCJI, AUTO_REZ.UPDATE_DATA AS AUTO_REZ__UPDATE_DATA, AUTO_REZ.UPDATE_USER AS AUTO_REZ__UPDATE_USER, AUTO_REZ.UWAGI AS AUTO_REZ__UWAGI, AUTO_REZ.UWAGI_SERWIS AS AUTO_REZ__UWAGI_SERWIS, AUTO_REZ.UZYTKOWNIK_OSOBA AS AUTO_REZ__UZYTKOWNIK_OSOBA, ZAMDOC_KL.ZAMDOC_ID AS ZAMDOC_KL__ZAMDOC_ID,
        (SELECT TOP 1 MYUSER.NAZWA+' '+MYUSER.IMIE 
        FROM KONTR_MYUSER_CON 
        INNER JOIN MYUSER ON MYUSER.MYUSER_ID=KONTR_MYUSER_CON.MYUSER_ID 
        INNER JOIN MYUSER_FUNKCJA ON MYUSER_FUNKCJA.MYUSER_FUNKCJA_ID=MYUSER.MYUSER_FUNKCJA_ID AND MYUSER_FUNKCJA.KOD='SPAU_FINANSISTA'
        WHERE KONTR_MYUSER_CON.KONTRAHENT_ID=KONTRAHENT.KONTRAHENT_ID) AS KONTRAHENT__DYR_MAKROREGIONU, 

        (SELECT TOP 1 MYUSER.NAZWA+' '+MYUSER.IMIE
        FROM KONTR_MYUSER_CON 
        INNER JOIN MYUSER ON MYUSER.MYUSER_ID=KONTR_MYUSER_CON.MYUSER_ID 
        INNER JOIN MYUSER_FUNKCJA ON MYUSER_FUNKCJA.MYUSER_FUNKCJA_ID=MYUSER.MYUSER_FUNKCJA_ID AND MYUSER_FUNKCJA.KOD='SPAU_KIEROWNIK'
        WHERE KONTR_MYUSER_CON.KONTRAHENT_ID=KONTRAHENT.KONTRAHENT_ID) AS KONTRAHENT__DYR_REGIONU, 

        (SELECT TOP 1 MYUSER.NAZWA+' '+MYUSER.IMIE 
        FROM KONTR_MYUSER_CON 
        INNER JOIN MYUSER ON MYUSER.MYUSER_ID=KONTR_MYUSER_CON.MYUSER_ID 
        INNER JOIN MYUSER_FUNKCJA ON MYUSER_FUNKCJA.MYUSER_FUNKCJA_ID=MYUSER.MYUSER_FUNKCJA_ID AND MYUSER_FUNKCJA.KOD='SPAU_HANDLOWIEC' 
        WHERE KONTR_MYUSER_CON.KONTRAHENT_ID=KONTRAHENT.KONTRAHENT_ID) AS KONTRAHENT__SPRZEDAWCA, 
        WPLATY.ILOSC AS WPLATY__ILOSC, KONTR_RODZAJ.NAZWA AS KONTRAHENT__RODZAJ, INSTYTUCJA.NAZWA AS ZAMDOC_KL__INSTYTUCJA_NAZWA, 
        CASE WHEN EXISTS (SELECT TOP 1 ZLECDOC_ID FROM ZLECDOC  WHERE ZLECDOC.AUTO_ID = AUTO_REZ.AUTO_ID) THEN CASE WHEN EXISTS (SELECT TOP 1 ZLECDOC_ID FROM ZLECDOC  WHERE ZLECDOC.AUTO_ID = AUTO_REZ.AUTO_ID AND ZLECDOC.IS_KSG = 0) THEN CASE WHEN EXISTS (SELECT TOP 1 ZLECDOC_ID FROM ZLECDOC  WHERE ZLECDOC.AUTO_ID = AUTO_REZ.AUTO_ID AND IS_KSG = 1) THEN 2 ELSE 1 END ELSE 3 END ELSE NULL END AS ZAMDOC_KL_POS__SERWIS, (CASE AUTO_P.IS_MASZYNA WHEN 0 THEN 'Podzesp' ELSE CASE AUTO_P.IS_MASZYNA WHEN 1  THEN 'Maszyna' ELSE NULL END  END) AS AUTO_POT__IS_MASZYNA, (CASE AUTO_REZ.IS_MASZYNA WHEN 0 THEN 'Podzesp' ELSE CASE AUTO_REZ.IS_MASZYNA WHEN 1 THEN 'Maszyna' ELSE NULL END END) AS AUTO_REZ__IS_MASZYNA, AUTO_TYP.NAZWA AS AUTO_POT__TYP_NAZWA, AUTO_MODEL.NAZWA AS AUTO_POT___MODEL_NAZWA, AUTO_PRODUCENT.NAZWA AS AUTO_POT___PRODUCENT_NAZWA, AUTO_RODZAJ.NAZWA AS AUTO_POT___RODZAJ_NAZWA, AUTO_RODZAJ_PODZESPOL.NAZWA AS AUTO_POT___RODZAJ_PODZESPOL_NAZWA, AUTO_TYP_REZ.NAZWA AS AUTO_REZ__TYP_NAZWA, AUTO_MODEL_REZ.NAZWA AS AUTO_REZ___MODEL_NAZWA, AUTO_PRODUCENT_REZ.NAZWA AS AUTO_REZ___PRODUCENT_NAZWA, AUTO_RODZAJ_REZ.NAZWA AS AUTO_REZ___RODZAJ_NAZWA, (CASE WHEN AUTO_P.IS_MASZYNA=1 THEN 1 ELSE CASE WHEN AUTO_MASZYNA.AUTO_ID IS NULL THEN 0 ELSE 1 END END) AS AUTO_POT__FROM_MASZYNA, DOC_STATUSEXT_P.NAZWA AS ZAMDOC_KL__STATUS_NAZWA, CASE DOC_STATUSEXT_P.KOD WHEN 'SUKCES' THEN 'Sukces' WHEN 'PORAZKA' THEN 'Porazka' WHEN 'NIEOKR' THEN 'Nieokreslony' END AS AUTO_POT__STATUS_KOD, AUTOR.NAZWA + ' ' + AUTOR.IMIE AS ZAMDOC_KL__AUTOR, ODP.NAZWA + ' ' + ODP.IMIE AS ZAMDOC_KL__ODP, ISNULL(WLASCICIEL.NAZWA,'') + ' ' + ISNULL(WLASCICIEL.IMIE,'') AS AUTO_REZ__WLASCICIEL_NAZWA, ISNULL(UZYTKOWNIK.NAZWA,'') + ' ' + ISNULL(UZYTKOWNIK.IMIE,'') AS AUTO_REZ__UZYTKOWNIK_NAZWA, NADZORUJACY.NAZWA + ' ' + NADZORUJACY.IMIE AS ZAMDOC_KL__NADZORUJACY, ODPOWIEDZIALNY.NAZWA + ' ' + ODPOWIEDZIALNY.IMIE AS FAKTDOC__ODPOWIEDZIALNY, PRZYGOTOWAL.NAZWA + ' ' + PRZYGOTOWAL.IMIE AS FAKTDOC__PRZYGOTOWAL, ODPOWIEDZIALNY_DS.NAZWA + ' ' + ODPOWIEDZIALNY_DS.IMIE AS ZAMDOC_DS__ODPOWIEDZIALNY, ZAMAWIAJACY_DS.NAZWA + ' ' + ZAMAWIAJACY_DS.IMIE AS ZAMDOC_DS__ZAMAWIAJACY, ZATWIERDZIL_DS.NAZWA + ' ' + ZATWIERDZIL_DS.IMIE AS ZAMDOC_DS__ZATWIERDZIL, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE KOD = ZAMDOC_POS_KL.MIEJSCE_WYDANIA AND RODZAJ_KOD = 'MIEJSCE_WYDANIA') AS ZAMDOC_POS_KL__MIEJSCE_WYDANIA, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'DOCZAM_STATUS' AND KOD=ZAMDOC_DS.STATUS) AS ZAMDOC_DS__STATUS, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'DOCZAM_WEW_STATUS' AND KOD=ZAMDOC_KL.STATUS) AS ZAMDOC_KL__STATUS, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_POCHODZENIE' AND KOD=AUTO_P.S_POCHODZENIE) AS AUTO_POT__AUTO_POCHODZENIE, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_POCHODZENIE' AND KOD=AUTO_REZ.S_POCHODZENIE) AS AUTO_REZ__AUTO_POCHODZENIE, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_P.S_STATUS AND IS_EXT=1) AS AUTO_POT__AUTO_STATUS, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0) AS AUTO_REZ__AUTO_STATUS, (SELECT TOP 1 NAZWA FROM KONTR_STATUS  WHERE KOD=KONTRAHENT.STATUS_KOD) AS KONTRAHENT__STATUS, (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'DOCZAM_TRANSPORT' AND KOD=ZAMDOC_POS_DS.TRANSPORT) AS ZAMDOC_POS_DS__TRANSPORT, AUTO_P.POTRZEBA_DATA AS AUTO_POT__POTRZEBA_DATA, (SELECT TOP 1 KOD FROM TOWAR_WALUTA WHERE TOWAR_WALUTA.TOWAR_WALUTA_ID=ZAMDOC_KL.TOWAR_WALUTA_ID) AS ZAMDOC_KL__TOWAR_WALUTA, CAST((CASE WHEN ZAMDOC_POS_KL.AUTO_ID IS NULL THEN 0 ELSE 1 END) AS bit) AS ZAMDOC_POS_KL__IS_REZERWACJA, (CAST(DATEPART(YYYY,ZAMDOC_POS_KL.TERMIN) as varchar(30)) + '-' + CAST(DATEPART(MM,ZAMDOC_POS_KL.TERMIN) as varchar(30))) AS ZAMDOC_POS_KL__TERMIN_WYDANIA_DATA, DATEPART(WW,ZAMDOC_POS_KL.TERMIN) AS ZAMDOC_POS_KL__TERMIN_WYDANIA_TYDZIEN, DATEPART(YYYY,ZAMDOC_POS_KL.TERMIN) AS ZAMDOC_POS_KL__TERMIN_WYDANIA_ROK, DATEPART(MM,ZAMDOC_POS_KL.TERMIN) AS ZAMDOC_POS_KL__TERMIN_WYDANIA_MIESIAC, AWEW_P.WALUTA_KOD_SP AS AUTO_POT_KALK__WALUTA_KOD_SP, AWEW_P.WALUTA_KURS_SP AS AUTO_POT_KALK__WALUTA_KURS_SP, AWEW_R.WALUTA_KOD_SP AS AUTO_POT_REZ__WALUTA_KOD_SP, AWEW_R.WALUTA_KURS_SP AS AUTO_POT_REZ__WALUTA_KURS_SP, FAKTDOC.NUMER AS FAKTDOC__NUMER, FAKTDOC.FAKTDOC_ID AS FAKTDOC__FAKTDOC_ID, (SELECT TOP 1 NAZWA FROM SLOWNIK  WHERE RODZAJ_KOD = 'DOCFAKT_STATUS' AND KOD=FAKTDOC.STATUS) AS FAKTDOC__STATUS, FAKTDOC.RODZAJ AS FAKTDOC__RODZAJ, FAKTDOC.DATA_WYSTAWIENIA AS FAKTDOC__DATA_WYSTAWIENIA, FAKTDOC.DATA_SPRZEDAZY AS FAKTDOC__DATA_SPRZEDAZY, FAKTDOC.WARTOSC_TOTAL_NETTO AS FAKTDOC__WARTOSC_NETTO, FAKTDOC.WARTOSC_TOTAL_BRUTTO AS FAKTDOC__WARTOSC_BRUTTO, ISNULL(FAKTDOC.ZAPLATA_ROZLICZNIE,0) AS FAKTDOC__ZAPLACONO, (FAKTDOC.WARTOSC_BRUTTO - ISNULL(FAKTDOC.ZAPLATA_ROZLICZNIE,0)) AS FAKTDOC__DO_ZAPLATY , (CASE ZAMDOC_POS_KL.F_REZERWACJA WHEN 0 THEN 0 ELSE 1 END) AS ZAMDOC_POS_KL__F_REZERWACJA, (CASE ZAMDOC_POS_KL.F_WYDANIE WHEN 0 THEN 0 ELSE 1 END) AS ZAMDOC_POS_KL__F_WYDANIE, (CASE ZAMDOC_POS_KL.F_WYDANIE WHEN 0 THEN 0 ELSE 1 END) AS ZAMDOC_POS_KL__F_WYSLANIE, (CASE ZAMDOC_POS_DS.F_WYDANIE WHEN 0 THEN 0 ELSE 1 END) AS ZAMDOC_POS_DS__F_WYSLANIE, (SELECT SUM(WARTOSC) FROM FAKTDOC_ROZLICZNIE WHERE FAKTDOC_ID = FAKTDOC.FAKTDOC_ID AND DATA<=GETDATE()) AS FAKTDOC__WPLATY_WYMAGANE_NA_DZIS, (SELECT SUM(ABS(WARTOSC_SALDO)) FROM TRANSDOC WHERE FAKTDOC_ID = FAKTDOC.FAKTDOC_ID AND TRANSDOC_EXT_PARENT_ID IS NULL AND IS_ZALICZKA=0 AND TERMIN<=GETDATE()) AS FAKTDOC__SALDO_NA_DZIS, (SELECT SUM (ISNULL(FPI.WARTOSC-FPI.WARTOSC_KOREKTA+FPI.WARTOSC_KOREKTA_WART,0)* CASE WHEN FP.FAKTDOC_POSKOREKTA_ID IS NULL THEN 1 ELSE 0 END)AS KOSZT_ZAKUPU FROM FAKTDOC_POS FP 
INNER JOIN FAKTDOC F ON F.FAKTDOC_ID = FP.FAKTDOC_ID 
LEFT JOIN FAKTDOC_POS_INDEKS FPI ON FPI.FAKTDOC_POS_ID = FP.FAKTDOC_POS_ID WHERE F.FAKTDOC_ID = FAKTDOC.FAKTDOC_ID) AS FAKTDOC__WARTOSC_KOSZT, (CASE WHEN FAKTDOC.WARTOSC_NETTO>0 THEN (ROUND (1 - (SELECT SUM(ISNULL(FPI.WARTOSC-FPI.WARTOSC_KOREKTA+FPI.WARTOSC_KOREKTA_WART,0)* CASE WHEN FP.FAKTDOC_POSKOREKTA_ID IS NULL THEN 1 ELSE 0 END) AS KOSZT_ZAKUPU FROM FAKTDOC_POS FP 
INNER JOIN FAKTDOC F ON F.FAKTDOC_ID = FP.FAKTDOC_ID 
LEFT JOIN FAKTDOC_POS_INDEKS FPI ON FPI.FAKTDOC_POS_ID = FP.FAKTDOC_POS_ID WHERE F.FAKTDOC_ID = FAKTDOC.FAKTDOC_ID)/FAKTDOC.WARTOSC_NETTO,2)*100) ELSE 0 END) AS FAKTDOC__MARZA, (SELECT TOP 1 TERMIN FROM ZAMDOC_FINANSOWANIE WHERE IS_ANULOWANY=0 AND IS_ZALICZKA=1 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID) AS ZAMDOC_KL__DATA_PIERWSZEJ_WPLATY, (SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=1 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE()) AS ZAMDOC_KL__UMPW_WYMAGANE_WPLATY_NA_DZIS_PLN, (SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC_EUR) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=1 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE()) AS ZAMDOC_KL__UMPW_WYMAGANE_WPLATY_NA_DZIS_EUR, (SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_ZOB,0)),0) FROM TRANSDOC WHERE IS_ZALICZKA=1 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) AS ZAMDOC_KL__UMPW_SUMA_ROZLICZONYCH_WPLAT_PLN, ((SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_ZOB,0)/KURS.KURS),0) FROM TRANSDOC 
INNER JOIN (SELECT TRANSDOC_ID,DATA,(SELECT TOP 1 KURS_2 FROM TOWAR_WALUTA_KURS WHERE TOWAR_WALUTA_KURS.DATA<=TRANSDOC.DATA ORDER BY TOWAR_WALUTA_KURS.DATA DESC) AS KURS FROM TRANSDOC WHERE ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) KURS ON KURS.TRANSDOC_ID=TRANSDOC.TRANSDOC_ID WHERE IS_ZALICZKA=1 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID)) AS ZAMDOC_KL__UMPW_SUMA_ROZLICZONYCH_WPLAT_EUR, -(SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=1 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE())+(SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_ZOB,0)),0) FROM TRANSDOC WHERE IS_ZALICZKA=1 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) AS ZAMDOC_KL__UMPW_SALDO_PLN, -(SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC_EUR) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=1 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE())+((SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_ZOB,0)/KURS.KURS),0) FROM TRANSDOC 
INNER JOIN (SELECT TRANSDOC_ID,DATA,(SELECT TOP 1 KURS_2 FROM TOWAR_WALUTA_KURS WHERE TOWAR_WALUTA_KURS.DATA<=TRANSDOC.DATA ORDER BY TOWAR_WALUTA_KURS.DATA DESC) AS KURS FROM TRANSDOC WHERE ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) KURS ON KURS.TRANSDOC_ID=TRANSDOC.TRANSDOC_ID WHERE IS_ZALICZKA=1 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID)) AS ZAMDOC_KL__UMPW_SALDO_EUR, (SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=0 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE()) AS ZAMDOC_KL__UMSP_WYMAGANE_WPLATY_NA_DZIS_PLN, (SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC_EUR) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=0 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE()) AS ZAMDOC_KL__UMSP_WYMAGANE_WPLATY_NA_DZIS_EUR, (SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_NAL,0)),0) FROM TRANSDOC WHERE IS_ZALICZKA=0 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) AS ZAMDOC_KL__UMSP_SUMA_ROZLICZONYCH_WPLAT_PLN, ((SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_NAL,0)/KURS.KURS),0) FROM TRANSDOC 
INNER JOIN (SELECT TRANSDOC_ID,DATA,(SELECT TOP 1 KURS_2 FROM TOWAR_WALUTA_KURS WHERE TOWAR_WALUTA_KURS.DATA<=TRANSDOC.DATA ORDER BY TOWAR_WALUTA_KURS.DATA DESC) AS KURS FROM TRANSDOC WHERE ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) KURS ON KURS.TRANSDOC_ID=TRANSDOC.TRANSDOC_ID WHERE IS_ZALICZKA=0 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID)) AS ZAMDOC_KL__UMSP_SUMA_ROZLICZONYCH_WPLAT_EUR, -(SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=0 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE())+(SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_NAL,0)),0) FROM TRANSDOC WHERE IS_ZALICZKA=0 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) AS ZAMDOC_KL__UMSP_SALDO_PLN, -(SELECT SUM(ZAMDOC_FINANSOWANIE.WARTOSC_EUR) FROM ZAMDOC_FINANSOWANIE  WHERE IS_ZALICZKA=0 AND IS_ANULOWANY=0 AND ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID AND TERMIN<=GETDATE())+((SELECT ISNULL(SUM(ISNULL(WARTOSC_PLN_BEG_NAL,0)/KURS.KURS),0) FROM TRANSDOC 
INNER JOIN (SELECT TRANSDOC_ID,DATA,(SELECT TOP 1 KURS_2 FROM TOWAR_WALUTA_KURS WHERE TOWAR_WALUTA_KURS.DATA<=TRANSDOC.DATA ORDER BY TOWAR_WALUTA_KURS.DATA DESC) AS KURS FROM TRANSDOC WHERE ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID) KURS ON KURS.TRANSDOC_ID=TRANSDOC.TRANSDOC_ID WHERE IS_ZALICZKA=0 AND ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID)) AS ZAMDOC_KL__UMSP_SALDO_EUR, (SELECT ISNULL(SUM(WARTOSC_PLN_SALDO),0) FROM TRANSDOC WHERE TRANSDOC.KONTRAHENT_ID=KONTRAHENT.KONTRAHENT_ID AND TRANSDOC.IS_ROZLICZONY<>1 AND TRANSDOC.TRANSDOC_EXT_PARENT_ID IS NULL) AS KONTRAHENT__BILANS, (SELECT COUNT(1) FROM ZLECDOC WHERE ZLECDOC.AUTO_ID=AUTO_REZ.AUTO_ID AND ZLECDOC.STATUS='OTW' AND ZLECDOC.DATA_BEG BETWEEN ISNULL(ZAMDOC_DS.DATA,'2000-01-01') AND ISNULL(ZAMDOC_POS_KL.DATA_TRANS_END,'2999-12-31')) AS ZLECDOC__OTWARTE, (SELECT COUNT(1) FROM ZLECDOC WHERE ZLECDOC.AUTO_ID=AUTO_REZ.AUTO_ID AND ZLECDOC.STATUS='ZAK' AND ZLECDOC.DATA_BEG BETWEEN ISNULL(ZAMDOC_DS.DATA,'2000-01-01') AND ISNULL(ZAMDOC_POS_KL.DATA_TRANS_END,'2999-12-31')) AS ZLECDOC__ZAMKNIETE, AWEW_P.WARTOSC_TOTAL_ZK_PLN AS AUTO_POT_KALK__WARTOSC_TOTAL_ZK_PLN, AWEW_P.WARTOSC_TOTAL_ZK_EUR AS AUTO_POT_KALK__WARTOSC_TOTAL_ZK_EUR, AWEW_P.WARTOSC_PREPARE_REAL_PLN AS AUTO_POT_KALK__WARTOSC_PREPARE_REAL_PLN, AWEW_P.WARTOSC_PREPARE_REAL_EUR AS AUTO_POT_KALK__WARTOSC_PREPARE_REAL_EUR, AWEW_P.WARTOSC_ALL_SP_PLN AS AUTO_POT_KALK__WARTOSC_ALL_SP_PLN, AWEW_P.WARTOSC_ALL_SP_EUR AS AUTO_POT_KALK__WARTOSC_ALL_SP_EUR, AWEW_P.WARTOSC_MARZA_I_PROCENT_PLN AS AUTO_POT_KALK__WARTOSC_MARZA_I_PROCENT_PLN, AWEW_P.WARTOSC_MARZA_I_PROCENT_EUR AS AUTO_POT_KALK__WARTOSC_MARZA_I_PROCENT_EUR, AWEW_P.WARTOSC_UPUST_I_PROCENT_PLN AS AUTO_POT_KALK__WARTOSC_UPUST_I_PROCENT_PLN, AWEW_P.WARTOSC_UPUST_I_PROCENT_EUR AS AUTO_POT_KALK__WARTOSC_UPUST_I_PROCENT_EUR, AWEW_P.WARTOSC_AKTUAL_PLN AS AUTO_POT_KALK__WARTOSC_AKTUAL_PLN, AWEW_P.WARTOSC_AKTUAL_EUR AS AUTO_POT_KALK__WARTOSC_AKTUAL_EUR, AWEW_P.WARTOSC_MARZA_II_PROCENT_PLN AS AUTO_POT_KALK__WARTOSC_MARZA_II_PROCENT_PLN, AWEW_P.WARTOSC_MARZA_II_PROCENT_EUR AS AUTO_POT_KALK__WARTOSC_MARZA_II_PROCENT_EUR, AWEW_P.WARTOSC_UPUST_II_PROCENT_PLN AS AUTO_POT_KALK__WARTOSC_UPUST_II_PROCENT_PLN, AWEW_P.WARTOSC_UPUST_II_PROCENT_EUR AS AUTO_POT_KALK__WARTOSC_UPUST_II_PROCENT_EUR, AWEW_P.WARTOSC_KOREKTA_PLN AS AUTO_POT_KALK__WARTOSC_KOREKTA_PLN, AWEW_P.WARTOSC_KOREKTA_EUR AS AUTO_POT_KALK__WARTOSC_KOREKTA_EUR, AWEW_P.WARTOSC_TOTAL_SP_PLN AS AUTO_POT_KALK__WARTOSC_TOTAL_SP_PLN, AWEW_P.WARTOSC_TOTAL_SP_EUR AS AUTO_POT_KALK__WARTOSC_TOTAL_SP_EUR, AWEW_P.WARTOSC_MARZA_III_PLN AS AUTO_POT_KALK__WARTOSC_MARZA_III_PLN, AWEW_P.WARTOSC_MARZA_III_EUR AS AUTO_POT_KALK__WARTOSC_MARZA_III_EUR, AWEW_P.WARTOSC_MARZA_III_PROCENT_PLN AS AUTO_POT_KALK__WARTOSC_MARZA_III_PROCENT_PLN, AWEW_P.WARTOSC_MARZA_III_PROCENT_EUR AS AUTO_POT_KALK__WARTOSC_MARZA_III_PROCENT_EUR, AWEW_R.WARTOSC_TOTAL_ZK_PLN AS AUTO_REZ_KALK__WARTOSC_TOTAL_ZK_PLN, AWEW_R.WARTOSC_TOTAL_ZK_EUR AS AUTO_REZ_KALK__WARTOSC_TOTAL_ZK_EUR, AWEW_R.WARTOSC_PREPARE_REAL_PLN AS AUTO_REZ_KALK__WARTOSC_PREPARE_REAL_PLN, AWEW_R.WARTOSC_PREPARE_REAL_EUR AS AUTO_REZ_KALK__WARTOSC_PREPARE_REAL_EUR, AWEW_R.WARTOSC_ALL_SP_PLN AS AUTO_REZ_KALK__WARTOSC_ALL_SP_PLN, AWEW_R.WARTOSC_ALL_SP_EUR AS AUTO_REZ_KALK__WARTOSC_ALL_SP_EUR, AWEW_R.WARTOSC_MARZA_I_PROCENT_PLN AS AUTO_REZ_KALK__WARTOSC_MARZA_I_PROCENT_PLN, AWEW_R.WARTOSC_MARZA_I_PROCENT_EUR AS AUTO_REZ_KALK__WARTOSC_MARZA_I_PROCENT_EUR, AWEW_R.WARTOSC_UPUST_I_PROCENT_PLN AS AUTO_REZ_KALK__WARTOSC_UPUST_I_PROCENT_PLN, AWEW_R.WARTOSC_UPUST_I_PROCENT_EUR AS AUTO_REZ_KALK__WARTOSC_UPUST_I_PROCENT_EUR, AWEW_R.WARTOSC_AKTUAL_PLN AS AUTO_REZ_KALK__WARTOSC_AKTUAL_PLN, AWEW_R.WARTOSC_AKTUAL_EUR AS AUTO_REZ_KALK__WARTOSC_AKTUAL_EUR, AWEW_R.WARTOSC_MARZA_II_PROCENT_PLN AS AUTO_REZ_KALK__WARTOSC_MARZA_II_PROCENT_PLN, AWEW_R.WARTOSC_MARZA_II_PROCENT_EUR AS AUTO_REZ_KALK__WARTOSC_MARZA_II_PROCENT_EUR, AWEW_R.WARTOSC_UPUST_II_PROCENT_PLN AS AUTO_REZ_KALK__WARTOSC_UPUST_II_PROCENT_PLN, AWEW_R.WARTOSC_UPUST_II_PROCENT_EUR AS AUTO_REZ_KALK__WARTOSC_UPUST_II_PROCENT_EUR, AWEW_R.WARTOSC_KOREKTA_PLN AS AUTO_REZ_KALK__WARTOSC_KOREKTA_PLN, AWEW_R.WARTOSC_KOREKTA_EUR AS AUTO_REZ_KALK__WARTOSC_KOREKTA_EUR, AWEW_R.WARTOSC_TOTAL_SP_PLN AS AUTO_REZ_KALK__WARTOSC_TOTAL_SP_PLN, AWEW_R.WARTOSC_TOTAL_SP_EUR AS AUTO_REZ_KALK__WARTOSC_TOTAL_SP_EUR, AWEW_R.WARTOSC_MARZA_III_PLN AS AUTO_REZ_KALK__WARTOSC_MARZA_III_PLN, AWEW_R.WARTOSC_MARZA_III_EUR AS AUTO_REZ_KALK__WARTOSC_MARZA_III_EUR, AWEW_R.WARTOSC_MARZA_III_PROCENT_PLN AS AUTO_REZ_KALK__WARTOSC_MARZA_III_PROCENT_PLN, AWEW_R.WARTOSC_MARZA_III_PROCENT_EUR AS AUTO_REZ_KALK__WARTOSC_MARZA_III_PROCENT_EUR, (CASE WHEN (AWEW_P.WARTOSC_TOTAL_SP_EUR=0)OR(AWEW_P.WARTOSC_TOTAL_SP_PLN=0) THEN 0 ELSE ROUND(CONVERT(DECIMAL(18),AWEW_P.WARTOSC_TOTAL_SP_PLN)/AWEW_P.WARTOSC_TOTAL_SP_EUR,4) END) AS AUTO_POT_KALK__WARTOSC_TOTAL_SP_STOSUNEK, (CASE WHEN (AWEW_R.WARTOSC_TOTAL_SP_EUR=0)OR(AWEW_R.WARTOSC_TOTAL_SP_PLN=0) THEN 0 ELSE ROUND(CONVERT(DECIMAL(18),AWEW_R.WARTOSC_TOTAL_SP_PLN)/AWEW_R.WARTOSC_TOTAL_SP_EUR,4) END) AS AUTO_REZ_KALK__WARTOSC_TOTAL_SP_STOSUNEK, (ROUND(CASE WHEN (AWEW_P.WARTOSC_TOTAL_SP_EUR=0)OR(AWEW_P.WARTOSC_TOTAL_SP_PLN=0)THEN 0 ELSE ROUND(CONVERT(DECIMAL(18),AWEW_P.WARTOSC_TOTAL_SP_PLN)/AWEW_P.WARTOSC_TOTAL_SP_EUR,4)END/AWEW_P.WALUTA_KURS_SP, 4)) AS AUTO_POT_KALK__WARTOSC_TOTAL_SP_STOSUNEK_KURS, (ROUND(CASE WHEN (AWEW_R.WARTOSC_TOTAL_SP_EUR=0)OR(AWEW_R.WARTOSC_TOTAL_SP_PLN=0)THEN 0 ELSE ROUND(CONVERT(DECIMAL(18),AWEW_R.WARTOSC_TOTAL_SP_PLN)/AWEW_R.WARTOSC_TOTAL_SP_EUR,4)END/AWEW_R.WALUTA_KURS_SP, 4)) AS AUTO_REZ_KALK__WARTOSC_TOTAL_SP_STOSUNEK_KURS, AWEW_R.UWAGI AS AUTO_REZ_KALK__UWAGI, CASE WHEN EXISTS (SELECT TOP 1 ZLECDOC_ID FROM ZLECDOC  WHERE ZLECDOC.AUTO_ID = AUTO_REZ.AUTO_ID AND ZLECDOC.IS_KSG=0) THEN (SELECT TOP 1 TOWAR_MAGAZYN.NAZWA FROM TOWAR_MAGAZYN 
INNER JOIN TOWAR ON TOWAR.TOWAR_MAGAZYN_ID=TOWAR_MAGAZYN.TOWAR_MAGAZYN_ID 
INNER JOIN TOWAR_INDEKS ON TOWAR_INDEKS.TOWAR_ID = TOWAR.TOWAR_ID WHERE TOWAR_INDEKS.AUTO_ID = AUTO_REZ.AUTO_ID) ELSE (SELECT TOP 1 MIEJSCE FROM TOWAR  WHERE TOWAR.AUTO_ID = AUTO_REZ.AUTO_ID AND TOWAR.ILOSC = 1) END AS AUTO_REZ__MIEJSCE, CASE WHEN EXISTS (SELECT TOP 1 ZLECDOC_ID FROM ZLECDOC  WHERE ZLECDOC.AUTO_ID = AUTO_REZ.AUTO_ID AND ZLECDOC.IS_KSG=0) THEN 'SERWIS' ELSE (SELECT TOP 1 TOWAR_MAGAZYN.NAZWA FROM TOWAR_MAGAZYN  
INNER JOIN TOWAR  ON TOWAR.TOWAR_MAGAZYN_ID = TOWAR_MAGAZYN.TOWAR_MAGAZYN_ID WHERE TOWAR.AUTO_ID = AUTO_REZ.AUTO_ID AND TOWAR.ILOSC = 1) END AS AUTO_REZ__MAGAZYN FROM AUTO AS AUTO_REZ  
LEFT JOIN ZAMDOC_POS ZAMDOC_POS_KL  ON AUTO_REZ.AUTO_ID = ZAMDOC_POS_KL.AUTO_ID 
LEFT JOIN ZAMDOC ZAMDOC_KL  ON ZAMDOC_POS_KL.ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID 
LEFT JOIN KONTRAHENT  ON KONTRAHENT.KONTRAHENT_ID = AUTO_REZ.WLASCICIEL_ID 
LEFT JOIN DOC D ON ZAMDOC_KL.DOC_ID = D.DOC_ID 
LEFT JOIN AUTO AUTO_P  ON ZAMDOC_POS_KL.AUTO_POTRZEBA_ID = AUTO_P.AUTO_ID 
LEFT JOIN AUTO_TYP  ON AUTO_TYP.AUTO_TYP_ID = AUTO_P.AUTO_TYP_ID 
LEFT JOIN AUTO_MODEL  ON AUTO_MODEL.AUTO_MODEL_ID = AUTO_TYP.AUTO_MODEL_ID 
LEFT JOIN AUTO_MARKA  ON AUTO_MARKA.AUTO_MARKA_ID = AUTO_MODEL.AUTO_MARKA_ID 
LEFT JOIN AUTO_PRODUCENT  ON AUTO_PRODUCENT.AUTO_PRODUCENT_ID = AUTO_MARKA.AUTO_PRODUCENT_ID 
LEFT JOIN AUTO_RODZAJ  ON AUTO_RODZAJ.AUTO_RODZAJ_ID = AUTO_MARKA.AUTO_RODZAJ_ID 
LEFT JOIN AUTO_RODZAJ_PODZESPOL  ON AUTO_RODZAJ_PODZESPOL.AUTO_RODZAJ_PODZESPOL_ID = AUTO_MARKA.AUTO_RODZAJ_PODZESPOL_ID 
LEFT JOIN DOC_STATUSEXT DOC_STATUSEXT_P  ON DOC_STATUSEXT_P.DOC_STATUSEXT_ID = ZAMDOC_KL.STATUS_ZAM AND ZAMDOC_KL.DOC_ID = DOC_STATUSEXT_P.DOC_ID 
LEFT JOIN AUTO_WYPOSAZENIE_EXT_WERSJA AWEW_P  ON AWEW_P.AUTO_ID = AUTO_P.AUTO_ID AND ((AWEW_P.ZAMDOC_ID = ZAMDOC_POS_KL.ZAMDOC_ID)OR(
AWEW_P.UWAGI='UMSP')) 
LEFT JOIN AUTO_TYP AUTO_TYP_REZ  ON AUTO_TYP_REZ.AUTO_TYP_ID = AUTO_REZ.AUTO_TYP_ID 
LEFT OUTER JOIN AUTO AUTO_MASZYNA  ON AUTO_MASZYNA.AUTO_ID = (SELECT TOP 1 A.AUTO_ID FROM AUTO A  
INNER JOIN AUTO_WYPOSAZENIE_EXT_WERSJA AW  ON A.AUTO_ID = AW.AUTO_ID 
INNER JOIN AUTO_WYPOSAZENIE_EXT_CON AWEC  ON AWEC.AUTO_WYPOSAZENIE_EXT_WERSJA_ID = AW.AUTO_WYPOSAZENIE_EXT_WERSJA_ID WHERE AWEC.AUTO_ID = AUTO_P.AUTO_ID AND A.IS_OFERTA = 1 AND AW.IS_ZATWIERDZONA = 1 ORDER BY AW.DATA DESC)  
LEFT JOIN AUTO_MODEL AUTO_MODEL_REZ  ON AUTO_MODEL_REZ.AUTO_MODEL_ID = AUTO_TYP_REZ.AUTO_MODEL_ID 
LEFT JOIN AUTO_MARKA AUTO_MARKA_REZ  ON AUTO_MARKA_REZ.AUTO_MARKA_ID = AUTO_MODEL_REZ.AUTO_MARKA_ID 
LEFT JOIN AUTO_PRODUCENT AUTO_PRODUCENT_REZ  ON AUTO_PRODUCENT_REZ.AUTO_PRODUCENT_ID = AUTO_MARKA_REZ.AUTO_PRODUCENT_ID 
LEFT JOIN AUTO_RODZAJ AUTO_RODZAJ_REZ  ON AUTO_RODZAJ_REZ.AUTO_RODZAJ_ID = AUTO_MARKA_REZ.AUTO_RODZAJ_ID 
LEFT JOIN AUTO_RODZAJ_PODZESPOL AUTO_RODZAJ_PODZESPOL_REZ  ON AUTO_RODZAJ_PODZESPOL_REZ.AUTO_RODZAJ_PODZESPOL_ID = AUTO_MARKA_REZ.AUTO_RODZAJ_PODZESPOL_ID 
LEFT JOIN ZAMDOC_POS ZAMDOC_POS_DS  ON ZAMDOC_POS_DS.ZAMDOC_POS_ID = (SELECT TOP 1 ZAMDOC_POS_ID FROM ZAMDOC_POS 
INNER JOIN ZAMDOC ON ZAMDOC.ZAMDOC_ID=ZAMDOC_POS.ZAMDOC_ID 
INNER JOIN DOC ON DOC.DOC_ID=ZAMDOC.DOC_ID WHERE DOC.RODZAJ_KOD='ZAMZA' AND ZAMDOC_POS.AUTO_ID=AUTO_REZ.AUTO_ID ORDER BY ZAMDOC.DATA DESC) 
LEFT JOIN ZAMDOC ZAMDOC_DS  ON ZAMDOC_DS.ZAMDOC_ID = ZAMDOC_POS_DS.ZAMDOC_ID 
LEFT JOIN DOC_STATUSEXT DOC_STATUSEXT_R  ON DOC_STATUSEXT_R.DOC_STATUSEXT_ID = ZAMDOC_DS.STATUS_ZAM AND ZAMDOC_DS.DOC_ID = DOC_STATUSEXT_R.DOC_ID 
LEFT JOIN AUTO_WYPOSAZENIE_EXT_WERSJA AWEW_R  ON AWEW_R.AUTO_ID = AUTO_REZ.AUTO_ID AND AWEW_R.IS_ACTUAL = 1 
LEFT JOIN MIEJSCE_WOJEWODZTWO  ON MIEJSCE_WOJEWODZTWO.MIEJSCE_WOJEWODZTWO_ID = KONTRAHENT.MIEJSCE_WOJEWODZTWO_ID 
LEFT JOIN MIEJSCE_POWIAT  ON MIEJSCE_POWIAT.MIEJSCE_POWIAT_ID = KONTRAHENT.MIEJSCE_POWIAT_ID 
LEFT JOIN KONTRAHENT INSTYTUCJA  ON INSTYTUCJA.KONTRAHENT_ID = ZAMDOC_KL.INSTYTUCJA_FINAN_ID 
LEFT JOIN KONTRAHENT UZYTKOWNIK  ON UZYTKOWNIK.KONTRAHENT_ID = AUTO_REZ.UZYTKOWNIK_ID 
LEFT JOIN KONTRAHENT WLASCICIEL  ON WLASCICIEL.KONTRAHENT_ID = AUTO_REZ.WLASCICIEL_ID 
LEFT JOIN MYUSER AUTOR  ON AUTOR.MYUSER_ID = ZAMDOC_KL.MYUSER_ID 
LEFT JOIN MYUSER ODP  ON ODP.MYUSER_ID = ZAMDOC_KL.MYUSER_ODP_ID 
LEFT JOIN MYUSER NADZORUJACY  ON NADZORUJACY.MYUSER_ID = ZAMDOC_KL.MYUSER_NADZORUJACY_ID 
LEFT JOIN MYUSER KUPUJACY  ON KUPUJACY.MYUSER_ID = ZAMDOC_KL.MYUSER_ZAMAWIAJACY_ID 
LEFT JOIN MYUSER SPRZEDAJACY  ON SPRZEDAJACY.MYUSER_ID = ZAMDOC_KL.MYUSER_ODPOWIEDZIALNY_ID 
LEFT OUTER JOIN (SELECT ZAMDOC_ID, COUNT(*) AS ILOSC FROM TRANSDOC  WHERE ZAMDOC_ID IS NOT NULL GROUP BY ZAMDOC_ID) WPLATY ON WPLATY.ZAMDOC_ID=ZAMDOC_KL.ZAMDOC_ID 
LEFT OUTER JOIN (SELECT FAKTDOC.*,FAKTDOC_POS.WARTOSC_TOTAL_NETTO,FAKTDOC_POS.WARTOSC_TOTAL_BRUTTO,DOC.NAZWA AS RODZAJ,ZPMC.ZAMDOC_POS_ID AS ZAMDOC_ID FROM ZAMDOC_POS_MAG_CON ZPMC 
INNER JOIN FAKTDOC_POS ON ZPMC.MAGDOC_POS_ID = FAKTDOC_POS.MAGDOC_POS_ID 
INNER JOIN FAKTDOC ON FAKTDOC.FAKTDOC_ID = FAKTDOC_POS.FAKTDOC_ID 
INNER JOIN DOC ON FAKTDOC.DOC_ID = DOC.DOC_ID AND DOC.TYP_KOD='SP') FAKTDOC ON FAKTDOC.ZAMDOC_ID = ZAMDOC_POS_KL.ZAMDOC_POS_ID 
LEFT OUTER JOIN KONTR_RODZAJ ON KONTRAHENT.KONTR_RODZAJ_ID=KONTR_RODZAJ.KONTR_RODZAJ_ID 
LEFT OUTER JOIN MIEJSCE_GMINA  ON MIEJSCE_GMINA.MIEJSCE_GMINA_ID=KONTRAHENT.MIEJSCE_GMINA_ID 
LEFT JOIN MYUSER ODPOWIEDZIALNY ON ODPOWIEDZIALNY.MYUSER_ID = FAKTDOC.MYUSER_ODPOWIEDZIALNY_ID 
LEFT JOIN MYUSER PRZYGOTOWAL ON PRZYGOTOWAL.MYUSER_ID = FAKTDOC.MYUSER_PRZYGOTOWAL_ID 
LEFT JOIN MYUSER ZATWIERDZIL ON ZATWIERDZIL.MYUSER_ID = FAKTDOC.MYUSER_ID 
LEFT JOIN MYUSER ODPOWIEDZIALNY_DS ON ODPOWIEDZIALNY_DS.MYUSER_ID = ZAMDOC_DS.MYUSER_ODPOWIEDZIALNY_ID 
LEFT JOIN MYUSER ZAMAWIAJACY_DS ON ZAMAWIAJACY_DS.MYUSER_ID = ZAMDOC_DS.MYUSER_ZAMAWIAJACY_ID 
LEFT JOIN MYUSER ZATWIERDZIL_DS ON ZATWIERDZIL_DS.MYUSER_ID = ZAMDOC_DS.MYUSER_ID 
LEFT JOIN TOWAR ON TOWAR.AUTO_ID = AUTO_REZ.AUTO_ID AND TOWAR.ILOSC = 1 
LEFT JOIN KONTR_TECZKA ON ZAMDOC_KL.KONTR_TECZKA_ID = KONTR_TECZKA.KONTR_TECZKA_ID 
LEFT JOIN KONTR_TECZKA_STATUS ON KONTR_TECZKA.KONTR_TECZKA_STATUS_ID = KONTR_TECZKA_STATUS.KONTR_TECZKA_STATUS_ID 
LEFT JOIN DOC_PARAM_EXT  ON DOC_PARAM_EXT.ZAMDOC_ID = ZAMDOC_KL.ZAMDOC_ID   WHERE (((SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0) LIKE '10%') OR ((SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0) LIKE '11%') OR ((SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0) LIKE '12%') OR ((SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0) LIKE '20%') OR ((SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0) LIKE '21%')) AND (AUTO_RODZAJ_PODZESPOL_REZ.NAZWA IS NULL  OR (AUTO_RODZAJ_PODZESPOL_REZ.NAZWA IS NOT NULL  AND LEN(TRIM(TRIM(AUTO_RODZAJ_PODZESPOL_REZ.NAZWA)))=0 )  ) AND AUTO_REZ.S_STATUS <> 'SW' AND AUTO_REZ.S_STATUS NOT LIKE 'PT%' AND EXISTS (SELECT TOP 1 NAZWA FROM SLOWNIK WHERE RODZAJ_KOD = 'AUTO_STATUS' AND KOD=AUTO_REZ.S_STATUS AND ISNULL(IS_EXT,0)=0)  AND AUTO_REZ.AUTO_ID NOT IN (SELECT ISNULL(ZP.AUTO_ID,0) FROM ZAMDOC_POS ZP  
INNER JOIN ZAMDOC Z  ON Z.ZAMDOC_ID = ZP.ZAMDOC_ID 
INNER JOIN DOC D  ON D.DOC_ID = Z.DOC_ID 
LEFT JOIN DOC_STATUSEXT DS  ON DS.DOC_STATUSEXT_ID = Z.STATUS_ZAM WHERE D.RODZAJ_KOD = 'ZAMWA' AND ZP.TERMIN_END IS NULL AND ISNULL(DS.KOD,'NIEOKR')='NIEOKR') AND (AUTO_REZ.IS_OFERTA=1 OR ISNULL(TOWAR.ILOSC_DYSP,0)>0 OR (ISNULL(ZAMDOC_POS_DS.F_KOMPLETACJA,1) = 0 AND ISNULL(ZAMDOC_POS_DS.IS_ANULOWANO,1) = 0 ))